import jwt from 'jsonwebtoken'; import { cookies } from 'next/headers'; const COOKIE_NAME='polipower_token'; export function signToken(p:object){const s=process.env.JWT_SECRET; if(!s) throw new Error('JWT_SECRET ontbreekt'); return jwt.sign(p,s,{expiresIn:'30d'})} export function getUserFromCookie():{id:number}|null{const c=cookies().get(COOKIE_NAME); if(!c?.value) return null; try{const s=process.env.JWT_SECRET; if(!s) return null; const d=jwt.verify(c.value,s) as any; return {id:d.id}}catch{return null}} export function setAuthCookie(t:string){cookies().set({name:COOKIE_NAME,value:t,httpOnly:true,sameSite:'lax',secure:process.env.NODE_ENV==='production',path:'/',maxAge:60*60*24*30})} export function clearAuthCookie(){cookies().set({name:COOKIE_NAME,value:'',httpOnly:true,sameSite:'lax',secure:process.env.NODE_ENV==='production',path:'/',expires:new Date(0)})}
